<script>
    import { boolean } from "../../../scripts/boolean.js";
    let node;
    let dimensões = window.innerWidth;
    export let value;
    const { tamanho, id, classe, posterMobile, fonteMobile, fonteDesk, posterDesk, preload, mostrarLegenda, legenda, crédito } = value;
    const playsinline = boolean(value.playsinline);
    const autoplay = boolean(value.autoplay);
    const muted = boolean(value.muted);
    const loop = boolean(value.loop);
    import { onMount } from "svelte";
    onMount(() => {
        let options = {
            rootMargin: '0px 0px 0px 0px',
            threshold: 0,
        }
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('carregada');
                    let video = node.querySelector('.uva-repositorio-media > video');
                    if (video !== null) {
                        video.src = video.dataset.src;
                        video.setAttribute("width", video.clientWidth);
                        video.setAttribute("height", video.clientHeight);
                        video.play();
                    }
                } else {
                    entry.target.classList.remove('carregada');
                    let video = node.querySelector('.uva-repositorio-media > video');
                    if (video !== null) {
                        video.pause();
                    }
                }
                window.addEventListener("resize", () => {
                    let video = node.querySelector('.uva-repositorio-media > video');
                    if (video !== null) {
                        video.setAttribute("width", video.clientWidth);
                        video.setAttribute("height", video.clientHeight);
                    }
                });
            });
        }, options);
        observer.observe(node);
    });
</script>
    <figure id={id} class="uva-repositorio-media {tamanho}" bind:this={node}>
        <video 
            width= "180"
            height= "120"
            class={classe} 
            playsinline={playsinline} 
            autoplay={autoplay}
            muted={muted}
            preload={preload} 
            loop={loop}
            data-src={ dimensões > 580 ? fonteDesk : fonteMobile }
        >
        </video>
        {#if mostrarLegenda == "sim"}
            <figcaption>
                <span class="uva-legenda-texto">{legenda}</span>
                <span class="uva-creditos"> • {crédito}</span>
            </figcaption>
        {:else}
            <figcaption style="text-align: right">
                <span class="uva-creditos">{crédito}</span>
            </figcaption>
        {/if}
    </figure>